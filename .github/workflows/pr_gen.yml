on:
  repository_dispatch:
    types: [manually_dispatched]

name: Generate PR for a requested manifest edit
jobs:
  generate:
    runs-on: ubuntu-22.04

    steps:
      - name: 📦 Checkout
        uses: actions/checkout@v4
        with:
            token: ${{ secrets.PAT }}

      - name: 🌐 Fetch Edit
        env:
            EDIT_URL: ${{ github.event.client_payload.edit_url }}
        run: |
            rm ./manifest.json
            wget $EDIT_URL -O ./manifest.json
            
      - name: Set Branch Name
        id: branch_name_gen
        run: |
            echo "::set-output name=bname::$(date +%s)"
            
      - name: 🍴 Commit & Fork
        uses: EndBug/add-and-commit@v9.1.3
        with:
            default_author: github_actions
            new_branch: edit_${{ steps.branch_name_gen.outputs.bname }}
            
      - name: 🔎 Generate PR
        uses: peter-evans/create-pull-request@v5.0.2
        with:
            token: ${{ secrets.PAT }}
            base: master
            committer: GitHub <noreply@github.com>
            author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
            signoff: false
            branch: edit_${{ steps.branch_name_gen.outputs.bname }}
            delete-branch: true
            draft: false